<div class="cx-fab-container-bottom-right">
  <button
    id="accept-button"
    mat-fab
    [disabled]="selectedVolume === null"
    [matTooltip]="'scraping.tooltip.select-scraping-issue' | translate"
    (click)="onDecision(true, selectedVolume)"
  >
    <mat-icon>check_box</mat-icon>
  </button>
</div>

<div
  *ngIf="showPopup && !!currentItem"
  class="cx-hover cx-centered cx-width-25 cx-border-primary-1"
>
  <mat-card appearance="outlined">
    <mat-card-title class="cx-text-nowrap">
      {{ currentItem | volumeMetadataTitle }}
    </mat-card-title>
    <mat-card-content class="cx-padding-5">
      <img
        loading="lazy"
        [src]="currentItem.imageUrl"
        width="100%"
        height="auto"
        [alt]="currentItem | volumeMetadataTitle"
      />
    </mat-card-content>
  </mat-card>
</div>

<mat-toolbar>
  <mat-paginator
    class="cx-height-100"
    *ngIf="!!comicBook"
    [pageSizeOptions]="pageSizeOptions"
    showFirstLastButtons="true"
  ></mat-paginator>
  <div class="cx-spacer"></div>
  <mat-form-field class="cx-width-50" appearance="outline">
    <input
      #filterInput
      id="filter-input"
      matInput
      [placeholder]="'comic-book.placeholder.scraping-filter' | translate"
      (keyup)="dataSource.filter = filterInput.value"
    />
    <mat-icon matPrefix>search</mat-icon>
  </mat-form-field>
  <button
    id="cancel-scraping-button"
    class="cx-toolbar-button"
    mat-icon-button
    [matTooltip]="'comic-book.tooltip.cancel-scraping' | translate"
    (click)="onCancelScraping()"
  >
    <mat-icon>cancel</mat-icon>
  </button>
</mat-toolbar>

<div class="cx-width-100 cx-detail-card-container">
  <mat-table
    aria-label="ComicBook files available for import"
    class="cx-width-100 cx-padding-2"
    [dataSource]="dataSource"
    matSort
    matSortActive="sortOrder"
    matSortDirection="desc"
    matSortDisableClear="false"
  >
    <ng-container matColumnDef="matchability">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        <mat-icon>thumbs_up_down</mat-icon>
      </mat-header-cell>
      <mat-cell *matCellDef="let entry">
        <span
          [matTooltip]="
            'comic-book.tooltip.match-' + entry.sortOrder | translate
          "
        >
          <mat-icon *ngIf="entry.sortOrder === 2">thumb_up</mat-icon>
          <mat-icon *ngIf="entry.sortOrder === 1">thumbs_up_down</mat-icon>
          <mat-icon *ngIf="entry.sortOrder === 0">thumb_down</mat-icon>
        </span>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="thumbnail">
      <mat-header-cell *matHeaderCellDef>
        {{ "scraping.label.thumbnail" | translate }}
      </mat-header-cell>
      <mat-cell *matCellDef="let entry">
        <img
          loading="lazy"
          [src]="entry.item.imageUrl"
          [alt]="entry.item.coverUrl"
          [style.width]="'100%'"
          [style.height]="'auto'"
          (mouseenter)="onShowPopup(entry.item)"
          (mouseleave)="onShowPopup(null)"
        />
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="publisher">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        {{ "scraping.label.publisher" | translate }}
      </mat-header-cell>
      <mat-cell *matCellDef="let entry">
        <div class="cx-width-100 cx-text-nowrap">
          {{ entry.item.publisher }}
        </div>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="name">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        {{ "scraping.label.series-name" | translate }}
      </mat-header-cell>
      <mat-cell *matCellDef="let entry">
        <div class="cx-width-100 cx-text-nowrap">{{ entry.item.name }}</div>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="start-year">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        {{ "scraping.label.start-year" | translate }}
      </mat-header-cell>
      <mat-cell *matCellDef="let entry">
        <div class="cx-width-100 cx-text-nowrap">
          {{ entry.item.startYear }}
        </div>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="issue-count">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        {{ "scraping.label.issue-count" | translate }}
      </mat-header-cell>
      <mat-cell *matCellDef="let entry">
        <div class="cx-width-100 cx-text-nowrap">
          {{ entry.item.issueCount }}
        </div>
      </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row
      *matRowDef="let row; columns: displayedColumns"
      [style.background]="selectedVolume?.id === row.item.id ? 'lightblue' : ''"
      (click)="onVolumeSelected(row.item)"
    ></mat-row>
    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell" colspan="4">
        {{ "comic-book.text.no-matching-volumes" | translate }}
      </td>
    </tr>
  </mat-table>
</div>
