<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
  <changeSet id="002_593_migrate_to_camel_case.xml"
             author="mcpierce">

    <!-- drop all foreign key constraints -->
    <dropForeignKeyConstraint baseTableName="comic_characters"
                              constraintName="comic_characters_comic_fk"/>
    <dropForeignKeyConstraint baseTableName="comic_credits"
                              constraintName="comic_credits_comic_fk"/>
    <dropForeignKeyConstraint baseTableName="comic_file_details"
                              constraintName="comic_file_details_comic_fk"/>
    <dropForeignKeyConstraint baseTableName="comic_file_entries"
                              constraintName="comic_file_entries_comic_fk"/>
    <dropForeignKeyConstraint baseTableName="comic_locations"
                              constraintName="comic_locations_comic_fk"/>
    <dropForeignKeyConstraint baseTableName="comic_story_arcs"
                              constraintName="comic_story_arcs_comic_fk"/>
    <dropForeignKeyConstraint baseTableName="comic_teams"
                              constraintName="comic_teams_comic_fk"/>
    <dropForeignKeyConstraint baseTableName="comics"
                              constraintName="comics_comic_format_fk"/>
    <dropForeignKeyConstraint baseTableName="comics"
                              constraintName="comics_scan_type_fk"/>
    <dropForeignKeyConstraint baseTableName="matchers"
                              constraintName="matchers_smart_reading_lits_fk"/>
    <dropForeignKeyConstraint baseTableName="matchers"
                              constraintName="matchers_matcher_fk"/>
    <dropForeignKeyConstraint baseTableName="pages"
                              constraintName="pages_comic_id"/>
    <dropForeignKeyConstraint baseTableName="pages"
                              constraintName="pages_page_type_fk"/>
    <dropForeignKeyConstraint baseTableName="reading_list_entries"
                              constraintName="reading_list_entries_reading_list_fk"/>
    <dropForeignKeyConstraint baseTableName="reading_lists"
                              constraintName="reading_lists_owner_fk"/>
    <dropForeignKeyConstraint baseTableName="smart_reading_lists"
                              constraintName="smart_reading_lists_owner_fk"/>
    <dropForeignKeyConstraint baseTableName="tasks"
                              constraintName="task_comic_fk"/>
    <dropForeignKeyConstraint baseTableName="task_properties"
                              constraintName="task_property_task_fk"/>
    <dropForeignKeyConstraint baseTableName="user_last_read_dates"
                              constraintName="user_last_read_dates_comic_fk"/>
    <dropForeignKeyConstraint baseTableName="user_last_read_dates"
                              constraintName="user_last_read_dates_user_fk"/>
    <dropForeignKeyConstraint baseTableName="user_preferences"
                              constraintName="user_preferences_user_fk"/>
    <dropForeignKeyConstraint baseTableName="users_roles"
                              constraintName="users_roles_user_fk"/>
    <dropForeignKeyConstraint baseTableName="users_roles"
                              constraintName="users_roles_role_fk"/>

    <!-- table renames and creations, plus columns and data migrations -->

    <renameTable oldTableName="blocked_page_hashes"
                 newTableName="BlockedPageHashes"/>
    <renameColumn tableName="BlockedPageHashes"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="BlockedPageHashes"
                  oldColumnName="hash"
                  newColumnName="Hash"
                  columnDataType="char(32)"/>

    <createTable tableName="TempBookmarks">
      <column name="Id"
              type="bigint">
        <constraints nullable="false"
                     unique="true"
                     primaryKey="true"/>
      </column>
      <column name="UserId"
              type="bigint">
        <constraints nullable="false"/>
      </column>
      <column name="ComicId"
              type="bigint">
        <constraints nullable="false"/>
      </column>
      <column name="Mark"
              type="varchar(32)">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addAutoIncrement tableName="TempBookmarks"
                      columnName="Id"
                      columnDataType="bigint"
                      startWith="1"/>

    <!-- copy data from the old bookmarks table -->
    <sql>INSERT INTO TempBookmarks(UserId,ComicId,Mark) SELECT user_id,comic_id,mark from bookmarks</sql>

    <dropTable tableName="bookmarks"/>
    <renameTable oldTableName="TempBookmarks"
                 newTableName="Bookmarks"/>

    <addUniqueConstraint tableName="Bookmarks"
                         columnNames="UserId,ComicId"
                         constraintName="BookmarksUniqueUserAndComicIdx"/>

    <renameTable oldTableName="comic_characters"
                 newTableName="Characters"/>
    <renameColumn tableName="Characters"
                  oldColumnName="comic_id"
                  newColumnName="ComicId"
                  columnDataType="bigint"/>
    <renameColumn tableName="Characters"
                  oldColumnName="character_name"
                  newColumnName="Name"
                  columnDataType="varchar(255)"/>

    <renameTable oldTableName="comic_credits"
                 newTableName="Credits"/>
    <renameColumn tableName="Credits"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="Credits"
                  oldColumnName="comic_id"
                  newColumnName="ComicId"
                  columnDataType="bigint"/>
    <renameColumn tableName="Credits"
                  oldColumnName="name"
                  newColumnName="Name"
                  columnDataType="varchar(128)"/>
    <renameColumn tableName="Credits"
                  oldColumnName="role"
                  newColumnName="Role"
                  columnDataType="varchar(128)"/>

    <renameTable oldTableName="comic_file_details"
                 newTableName="ComicFileDetails"/>
    <renameColumn tableName="ComicFileDetails"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="ComicFileDetails"
                  oldColumnName="comic_id"
                  newColumnName="ComicId"
                  columnDataType="bigint"/>
    <renameColumn tableName="ComicFileDetails"
                  oldColumnName="file_hash"
                  newColumnName="FileHash"
                  columnDataType="char(32)"/>

    <renameTable oldTableName="comic_file_entries"
                 newTableName="ComicFileEntries"/>
    <renameColumn tableName="ComicFileEntries"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="ComicFileEntries"
                  oldColumnName="comic_id"
                  newColumnName="ComicId"
                  columnDataType="bigint"/>
    <renameColumn tableName="ComicFileEntries"
                  oldColumnName="file_number"
                  newColumnName="FileNumber"
                  columnDataType="int"/>
    <renameColumn tableName="ComicFileEntries"
                  oldColumnName="file_name"
                  newColumnName="FileName"
                  columnDataType="varchar(1024)"/>
    <renameColumn tableName="ComicFileEntries"
                  oldColumnName="file_size"
                  newColumnName="FileSize"
                  columnDataType="int"/>
    <renameColumn tableName="ComicFileEntries"
                  oldColumnName="file_type"
                  newColumnName="FileType"
                  columnDataType="varchar(256)"/>

    <renameTable oldTableName="comic_formats"
                 newTableName="ComicFormats"/>
    <renameColumn tableName="ComicFormats"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="ComicFormats"
                  oldColumnName="name"
                  newColumnName="Name"
                  columnDataType="varchar(32)"/>

    <renameTable oldTableName="comic_locations"
                 newTableName="Locations"/>
    <renameColumn tableName="Locations"
                  oldColumnName="comic_id"
                  newColumnName="ComicId"
                  columnDataType="bigint"/>
    <renameColumn tableName="Locations"
                  oldColumnName="location_name"
                  newColumnName="Name"
                  columnDataType="varchar(255)"/>

    <renameTable oldTableName="comic_story_arcs"
                 newTableName="Stories"/>
    <renameColumn tableName="Stories"
                  oldColumnName="comic_id"
                  newColumnName="ComicId"
                  columnDataType="bigint"/>
    <renameColumn tableName="Stories"
                  oldColumnName="story_name"
                  newColumnName="Name"
                  columnDataType="varchar(255)"/>

    <renameTable oldTableName="comic_teams"
                 newTableName="Teams"/>
    <renameColumn tableName="Teams"
                  oldColumnName="comic_id"
                  newColumnName="ComicId"
                  columnDataType="bigint"/>
    <renameColumn tableName="Teams"
                  oldColumnName="team_name"
                  newColumnName="Name"
                  columnDataType="varchar(255)"/>

    <renameTable oldTableName="comics"
                 newTableName="old_comics"/>
    <renameTable oldTableName="old_comics"
                 newTableName="Comics"/>
    <renameColumn tableName="Comics"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="Comics"
                  oldColumnName="filename"
                  newColumnName="Filename"
                  columnDataType="varchar(1024)"/>
    <renameColumn tableName="Comics"
                  oldColumnName="archive_type"
                  newColumnName="ArchiveType"
                  columnDataType="varchar(4)"/>
    <renameColumn tableName="Comics"
                  oldColumnName="publisher"
                  newColumnName="Publisher"
                  columnDataType="varchar(128)"/>
    <renameColumn tableName="Comics"
                  oldColumnName="series"
                  newColumnName="Series"
                  columnDataType="varchar(128)"/>
    <renameColumn tableName="Comics"
                  oldColumnName="volume"
                  newColumnName="Volume"
                  columnDataType="varchar(4)"/>
    <renameColumn tableName="Comics"
                  oldColumnName="issue_number"
                  newColumnName="IssueNumber"
                  columnDataType="varchar(16)"/>
    <renameColumn tableName="Comics"
                  oldColumnName="imprint"
                  newColumnName="Imprint"
                  columnDataType="varchar(64)"/>
    <renameColumn tableName="Comics"
                  oldColumnName="scan_type_id"
                  newColumnName="ScanTypeId"
                  columnDataType="bigint"/>
    <renameColumn tableName="Comics"
                  oldColumnName="format_id"
                  newColumnName="FormatId"
                  columnDataType="bigint"/>
    <renameColumn tableName="Comics"
                  oldColumnName="added_date"
                  newColumnName="CreatedOn"
                  columnDataType="timestamp"/>
    <renameColumn tableName="Comics"
                  oldColumnName="deleted_date"
                  newColumnName="DeletedOn"
                  columnDataType="datetime"/>
    <renameColumn tableName="Comics"
                  oldColumnName="last_updated_date"
                  newColumnName="LastUpdatedOn"
                  columnDataType="datetime"/>
    <renameColumn tableName="Comics"
                  oldColumnName="comic_vine_id"
                  newColumnName="ComicVineId"
                  columnDataType="varchar(16)"/>
    <renameColumn tableName="Comics"
                  oldColumnName="cover_date"
                  newColumnName="CoverDate"
                  columnDataType="date"/>
    <renameColumn tableName="Comics"
                  oldColumnName="sort_name"
                  newColumnName="SortName"
                  columnDataType="varchar(128)"/>
    <renameColumn tableName="Comics"
                  oldColumnName="title"
                  newColumnName="Title"
                  columnDataType="varchar(128)"/>
    <renameColumn tableName="Comics"
                  oldColumnName="description"
                  newColumnName="Description"
                  columnDataType="clob"/>

    <dropColumn tableName="Comics"
                columnName="notes"/>

    <renameTable oldTableName="matchers"
                 newTableName="SmartListMatchers"/>
    <renameColumn tableName="SmartListMatchers"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="SmartListMatchers"
                  oldColumnName="type"
                  newColumnName="MatcherType"
                  columnDataType="varchar(128)"/>
    <renameColumn tableName="SmartListMatchers"
                  oldColumnName="negative"
                  newColumnName="Negative"
                  columnDataType="boolean"/>
    <renameColumn tableName="SmartListMatchers"
                  oldColumnName="mode"
                  newColumnName="MatcherMode"
                  columnDataType="varchar(255)"/>
    <renameColumn tableName="SmartListMatchers"
                  oldColumnName="operator"
                  newColumnName="MatcherOperator"
                  columnDataType="varchar(255)"/>
    <renameColumn tableName="SmartListMatchers"
                  oldColumnName="value"
                  newColumnName="MatcherValue"
                  columnDataType="varchar(255)"/>
    <renameColumn tableName="SmartListMatchers"
                  oldColumnName="smart_list_id"
                  newColumnName="SmartListId"
                  columnDataType="bigint"/>
    <renameColumn tableName="SmartListMatchers"
                  oldColumnName="matcher_id"
                  newColumnName="NextMatcherId"
                  columnDataType="bigint"/>

    <renameTable oldTableName="page_types"
                 newTableName="PageTypes"/>
    <renameColumn tableName="PageTypes"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="PageTypes"
                  oldColumnName="name"
                  newColumnName="Name"
                  columnDataType="varchar(32)"/>

    <renameTable oldTableName="pages"
                 newTableName="old_pages"/>
    <renameTable oldTableName="old_pages"
                 newTableName="Pages"/>
    <renameColumn tableName="Pages"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="Pages"
                  oldColumnName="comic_id"
                  newColumnName="ComicId"
                  columnDataType="bigint"/>
    <renameColumn tableName="Pages"
                  oldColumnName="type_id"
                  newColumnName="TypeId"
                  columnDataType="bigint"/>
    <renameColumn tableName="Pages"
                  oldColumnName="filename"
                  newColumnName="Filename"
                  columnDataType="varchar(128)"/>
    <renameColumn tableName="Pages"
                  oldColumnName="hash"
                  newColumnName="FileHash"
                  columnDataType="char(32)"/>
    <renameColumn tableName="Pages"
                  oldColumnName="page_number"
                  newColumnName="PageNumber"
                  columnDataType="int"/>
    <renameColumn tableName="Pages"
                  oldColumnName="deleted"
                  newColumnName="Deleted"
                  columnDataType="boolean"/>
    <renameColumn tableName="Pages"
                  oldColumnName="width"
                  newColumnName="Width"
                  columnDataType="int"/>
    <renameColumn tableName="Pages"
                  oldColumnName="height"
                  newColumnName="Height"
                  columnDataType="int"/>

    <dropTable tableName="publishers"/>

    <renameTable oldTableName="reading_list_entries"
                 newTableName="ReadingListEntries"/>
    <renameColumn tableName="ReadingListEntries"
                  oldColumnName="reading_list_id"
                  newColumnName="ReadingListId"
                  columnDataType="bigint"/>
    <renameColumn tableName="ReadingListEntries"
                  oldColumnName="comic_id"
                  newColumnName="ComicId"
                  columnDataType="bigint"/>

    <renameTable oldTableName="reading_lists"
                 newTableName="ReadingLists"/>
    <renameColumn tableName="ReadingLists"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="ReadingLists"
                  oldColumnName="name"
                  newColumnName="Name"
                  columnDataType="varchar(128)"/>
    <renameColumn tableName="ReadingLists"
                  oldColumnName="summary"
                  newColumnName="Summary"
                  columnDataType="varchar(256)"/>
    <renameColumn tableName="ReadingLists"
                  oldColumnName="owner_id"
                  newColumnName="OwnerId"
                  columnDataType="bigint"/>
    <renameColumn tableName="ReadingLists"
                  oldColumnName="last_updated"
                  newColumnName="LastUpdated"
                  columnDataType="timestamp"/>

    <renameTable oldTableName="rest_audit_log"
                 newTableName="WebAuditLogEntries"/>
    <renameColumn tableName="WebAuditLogEntries"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="WebAuditLogEntries"
                  oldColumnName="remote_ip"
                  newColumnName="RemoteIp"
                  columnDataType="varchar(15)"/>
    <renameColumn tableName="WebAuditLogEntries"
                  oldColumnName="url"
                  newColumnName="URL"
                  columnDataType="varchar(256)"/>
    <renameColumn tableName="WebAuditLogEntries"
                  oldColumnName="method"
                  newColumnName="Method"
                  columnDataType="varchar(32)"/>
    <renameColumn tableName="WebAuditLogEntries"
                  oldColumnName="request_content"
                  newColumnName="RequestContent"
                  columnDataType="clob"/>
    <renameColumn tableName="WebAuditLogEntries"
                  oldColumnName="response_content"
                  newColumnName="ResponseContent"
                  columnDataType="clob"/>
    <renameColumn tableName="WebAuditLogEntries"
                  oldColumnName="email"
                  newColumnName="Email"
                  columnDataType="varchar(256)"/>
    <renameColumn tableName="WebAuditLogEntries"
                  oldColumnName="start_time"
                  newColumnName="StartedAt"
                  columnDataType="timestamp"/>
    <renameColumn tableName="WebAuditLogEntries"
                  oldColumnName="successful"
                  newColumnName="Successful"
                  columnDataType="boolean"/>
    <renameColumn tableName="WebAuditLogEntries"
                  oldColumnName="exception"
                  newColumnName="Exception"
                  columnDataType="clob"/>

    <addColumn tableName="WebAuditLogEntries">
      <column name="EndedAt"
              type="datetime"
              defaultValue="null"></column>
    </addColumn>

    <sql>UPDATE WebAuditLogEntries SET EndedAt=end_time</sql>

    <dropColumn tableName="WebAuditLogEntries"
                columnName="end_time"/>

    <addNotNullConstraint tableName="WebAuditLogEntries"
                          columnName="EndedAt"
                          columnDataType="datetime"/>

    <renameTable oldTableName="roles"
                 newTableName="old_roles"/>
    <renameTable oldTableName="old_roles"
                 newTableName="Roles"/>
    <renameColumn tableName="Roles"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="Roles"
                  oldColumnName="name"
                  newColumnName="Name"
                  columnDataType="varchar(32)"/>

    <renameTable oldTableName="scan_types"
                 newTableName="ScanTypes"/>
    <renameColumn tableName="ScanTypes"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="ScanTypes"
                  oldColumnName="name"
                  newColumnName="Name"
                  columnDataType="varchar(32)"/>

    <dropTable tableName="scraping_cache_entries"/>

    <dropTable tableName="scraping_cache"/>

    <createTable tableName="ScrapingCache">
      <column name="Id"
              type="bigint">
        <constraints nullable="false"
                     unique="true"
                     primaryKey="true"/>
      </column>
      <column name="Source"
              type="varchar(32)">
        <constraints nullable="false"/>
      </column>
      <column name="CacheKey"
              type="varchar(32)">
        <constraints nullable="false"/>
      </column>
      <column name="CreatedOn"
              type="timestamp">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addAutoIncrement tableName="ScrapingCache"
                      columnName="Id"
                      columnDataType="bigint"
                      startWith="1"/>

    <createTable tableName="ScrapingCacheEntries">
      <column name="Id"
              type="bigint">
        <constraints nullable="false"
                     unique="true"
                     primaryKey="true"/>
      </column>
      <column name="ScrapingCacheId"
              type="bigint">
        <constraints nullable="false"/>
      </column>
      <column name="EntryNumber"
              type="int">
        <constraints nullable="false"/>
      </column>
      <column name="EntryValue"
              type="clob">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addAutoIncrement tableName="ScrapingCacheEntries"
                      columnName="Id"
                      columnDataType="bigint"
                      startWith="1"/>

    <addUniqueConstraint tableName="ScrapingCacheEntries"
                         columnNames="ScrapingCacheId,EntryNumber"
                         constraintName="ScrapingCacheEntriesUniqueScrapingCacheAndEntryIdx"/>

    <addUniqueConstraint tableName="ScrapingCache"
                         columnNames="Source,CacheKey"
                         constraintName="ScrapingCacheUniqueUniqueSourceAndCacheKey"/>

    <createIndex tableName="ScrapingCache"
                 indexName="ScrapingCacheSourceKeyIdx">
      <column name="Source"/>
      <column name="CacheKey"/>
    </createIndex>

    <renameTable oldTableName="smart_reading_lists"
                 newTableName="SmartReadingLists"/>
    <renameColumn tableName="SmartReadingLists"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="SmartReadingLists"
                  oldColumnName="name"
                  newColumnName="Name"
                  columnDataType="varchar(128)"/>
    <renameColumn tableName="SmartReadingLists"
                  oldColumnName="summary"
                  newColumnName="Summary"
                  columnDataType="varchar(128)"/>
    <renameColumn tableName="SmartReadingLists"
                  oldColumnName="owner_id"
                  newColumnName="OwnerId"
                  columnDataType="bigint"/>
    <renameColumn tableName="SmartReadingLists"
                  oldColumnName="created"
                  newColumnName="CreatedOn"
                  columnDataType="timestamp"/>
    <renameColumn tableName="SmartReadingLists"
                  oldColumnName="negative"
                  newColumnName="Negative"
                  columnDataType="boolean"/>
    <renameColumn tableName="SmartReadingLists"
                  oldColumnName="mode"
                  newColumnName="MatcherMode"
                  columnDataType="varchar(255)"/>

    <renameTable oldTableName="task_audit_log"
                 newTableName="TaskAuditLog"/>
    <renameColumn tableName="TaskAuditLog"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="TaskAuditLog"
                  oldColumnName="start_time"
                  newColumnName="StartedAt"
                  columnDataType="timestamp"/>
    <renameColumn tableName="TaskAuditLog"
                  oldColumnName="successful"
                  newColumnName="Successful"
                  columnDataType="boolean"/>
    <renameColumn tableName="TaskAuditLog"
                  oldColumnName="description"
                  newColumnName="Description"
                  columnDataType="varchar(2048)"/>
    <renameColumn tableName="TaskAuditLog"
                  oldColumnName="exception"
                  newColumnName="Exception"
                  columnDataType="clob"/>

    <addColumn tableName="TaskAuditLog">
      <column name="EndedAt"
              type="datetime"
              defaultValue="null"></column>
    </addColumn>

    <sql>UPDATE TaskAuditLog SET EndedAt=end_time</sql>

    <dropColumn tableName="TaskAuditLog"
                columnName="end_time"/>

    <addNotNullConstraint tableName="TaskAuditLog"
                          columnName="EndedAt"
                          columnDataType="datetime"/>

    <renameTable oldTableName="tasks"
                 newTableName="old_tasks"/>
    <renameTable oldTableName="old_tasks"
                 newTableName="Tasks"/>
    <renameColumn tableName="Tasks"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="Tasks"
                  oldColumnName="task_type"
                  newColumnName="TaskType"
                  columnDataType="varchar(128)"/>
    <renameColumn tableName="Tasks"
                  oldColumnName="comic_id"
                  newColumnName="ComicId"
                  columnDataType="bigint"/>
    <renameColumn tableName="Tasks"
                  oldColumnName="created"
                  newColumnName="CreatedOn"
                  columnDataType="timestamp"/>

    <renameTable oldTableName="task_properties"
                 newTableName="TaskProperties"/>
    <renameColumn tableName="TaskProperties"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="TaskProperties"
                  oldColumnName="task_id"
                  newColumnName="TaskId"
                  columnDataType="bigint"/>
    <renameColumn tableName="TaskProperties"
                  oldColumnName="name"
                  newColumnName="Name"
                  columnDataType="varchar(128)"/>
    <renameColumn tableName="TaskProperties"
                  oldColumnName="value"
                  newColumnName="Value"
                  columnDataType="varchar(1024)"/>

    <renameTable oldTableName="users"
                 newTableName="old_users"/>
    <renameTable oldTableName="old_users"
                 newTableName="Users"/>
    <renameColumn tableName="Users"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="Users"
                  oldColumnName="email"
                  newColumnName="Email"
                  columnDataType="varchar(256)"/>
    <renameColumn tableName="Users"
                  oldColumnName="password_hash"
                  newColumnName="PasswordHash"
                  columnDataType="varchar(64)"/>
    <renameColumn tableName="Users"
                  oldColumnName="first_login_date"
                  newColumnName="CreatedOn"
                  columnDataType="timestamp"/>
    <renameColumn tableName="Users"
                  oldColumnName="last_login_date"
                  newColumnName="LastLoggedOn"
                  columnDataType="datetime"/>

    <renameTable oldTableName="user_last_read_dates"
                 newTableName="LastReadDates"/>
    <renameColumn tableName="LastReadDates"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="LastReadDates"
                  oldColumnName="comic_id"
                  newColumnName="ComicId"
                  columnDataType="bigint"/>
    <renameColumn tableName="LastReadDates"
                  oldColumnName="user_id"
                  newColumnName="UserId"
                  columnDataType="bigint"/>
    <renameColumn tableName="LastReadDates"
                  oldColumnName="last_read"
                  newColumnName="LastReadOn"
                  columnDataType="timestamp"/>

    <addColumn tableName="LastReadDates">
      <column name="CreatedOn"
              type="datetime"></column>
    </addColumn>

    <sql>UPDATE LastReadDates SET CreatedOn=created_on</sql>

    <addNotNullConstraint tableName="LastReadDates"
                          columnName="CreatedOn"
                          columnDataType="datetime"/>

    <addColumn tableName="LastReadDates">
      <column name="LastUpdated"
              type="datetime"></column>
    </addColumn>

    <sql>UPDATE LastReadDates SET LastUpdated=last_updated</sql>

    <addNotNullConstraint tableName="LastReadDates"
                          columnName="LastUpdated"
                          columnDataType="datetime"/>

    <dropColumn tableName="LastReadDates"
                columnName="last_updated"/>

    <renameTable oldTableName="user_preferences"
                 newTableName="UserPreferences"/>
    <renameColumn tableName="UserPreferences"
                  oldColumnName="id"
                  newColumnName="Id"
                  columnDataType="bigint"/>
    <renameColumn tableName="UserPreferences"
                  oldColumnName="user_id"
                  newColumnName="UserId"
                  columnDataType="bigint"/>
    <renameColumn tableName="UserPreferences"
                  oldColumnName="name"
                  newColumnName="Name"
                  columnDataType="varchar(128)"/>
    <renameColumn tableName="UserPreferences"
                  oldColumnName="value"
                  newColumnName="Value"
                  columnDataType="varchar(256)"/>

    <renameTable oldTableName="users_roles"
                 newTableName="UsersRoles"/>
    <renameColumn tableName="UsersRoles"
                  oldColumnName="user_id"
                  newColumnName="UserId"
                  columnDataType="bigint"/>
    <renameColumn tableName="UsersRoles"
                  oldColumnName="role_id"
                  newColumnName="RoleId"
                  columnDataType="bigint"/>

    <dropIndex tableName="ComicFileDetails"
               indexName="idx_comic_file_details_file_hash"/>
    <createIndex tableName="ComicFileDetails"
                 indexName="ComicFileDetailsFileHashIdx">
      <column name="FileHash"/>
    </createIndex>

    <dropIndex tableName="TaskAuditLog"
               indexName="task_audit_log_start_time_idx"/>
    <createIndex tableName="TaskAuditLog"
                 indexName="TaskAuditLogStartedAtIdx">
      <column name="StartedAt"/>
    </createIndex>

    <dropIndex tableName="TaskAuditLog"
               indexName="task_audit_log_successful_idx"/>

    <dropIndex tableName="TaskProperties"
               indexName="task_property_task_idx"/>

    <createIndex tableName="TaskProperties"
                 indexName="TaskPropertyTaskIdx">
      <column name="TaskId"/>
    </createIndex>

    <addUniqueConstraint tableName="Users"
                         columnNames="Email"
                         constraintName="UsersUniqueEmailIdx"/>

    <addUniqueConstraint tableName="UserPreferences"
                         columnNames="UserId,Name"
                         constraintName="UserPreferencesUniqueUserAndNameIdx"/>

    <addUniqueConstraint tableName="Roles"
                         columnNames="Name"
                         constraintName="RolesUniqueNameIdx"/>

    <dropIndex tableName="WebAuditLogEntries"
               indexName="rest_audit_log_start_time_idx"/>
    <createIndex tableName="WebAuditLogEntries"
                 indexName="WebAuditLogEntryStartedAtIdx">
      <column name="StartedAt"/>
    </createIndex>

    <dropIndex tableName="WebAuditLogEntries"
               indexName="rest_audit_log_successful_idx"/>

    <!-- add foreign key constraints -->

    <addForeignKeyConstraint baseTableName="Bookmarks"
                             baseColumnNames="UserId"
                             constraintName="BookmarksUserFk"
                             referencedTableName="Users"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="Characters"
                             baseColumnNames="ComicId"
                             constraintName="CharactersComicFk"
                             referencedTableName="Comics"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="ComicFileDetails"
                             baseColumnNames="ComicId"
                             constraintName="ComicFileDetailsComicFk"
                             referencedTableName="Comics"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="ComicFileEntries"
                             baseColumnNames="ComicId"
                             constraintName="ComicFileEntriesComicFk"
                             referencedTableName="Comics"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="Comics"
                             baseColumnNames="ScanTypeId"
                             constraintName="ComicScanTypeFk"
                             referencedTableName="ScanTypes"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="Comics"
                             baseColumnNames="FormatId"
                             constraintName="ComicsComicFormatFk"
                             referencedTableName="ComicFormats"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="Credits"
                             baseColumnNames="ComicId"
                             constraintName="CreditComicFk"
                             referencedTableName="Comics"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="LastReadDates"
                             baseColumnNames="ComicId"
                             constraintName="LastReadDatesComicFk"
                             referencedTableName="Comics"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="LastReadDates"
                             baseColumnNames="UserId"
                             constraintName="LastReadDatesUserFk"
                             referencedTableName="Users"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="Locations"
                             baseColumnNames="ComicId"
                             constraintName="LocationsComicFk"
                             referencedTableName="Comics"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="Pages"
                             baseColumnNames="ComicId"
                             constraintName="PagesComicFk"
                             referencedTableName="Comics"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="Pages"
                             baseColumnNames="TypeId"
                             constraintName="PagesPageTypeFk"
                             referencedTableName="PageTypes"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="ReadingListEntries"
                             baseColumnNames="ReadingListId"
                             constraintName="ReadingListEntriesReadingListFk"
                             referencedTableName="ReadingLists"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="ReadingListEntries"
                             baseColumnNames="ComicId"
                             constraintName="ReadingListEntriesComicFk"
                             referencedTableName="Comics"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="ReadingLists"
                             baseColumnNames="OwnerId"
                             constraintName="ReadingListsOwnerFk"
                             referencedTableName="Users"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="SmartListMatchers"
                             baseColumnNames="SmartListId"
                             constraintName="SmartListMatchersSmartListFk"
                             referencedTableName="SmartReadingLists"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="SmartListMatchers"
                             baseColumnNames="NextMatcherId"
                             constraintName="SmartListMatchersNextMatcherFk"
                             referencedTableName="SmartListMatchers"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="SmartReadingLists"
                             baseColumnNames="OwnerId"
                             constraintName="SmartReadingListsOwnerFk"
                             referencedTableName="Users"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="Stories"
                             baseColumnNames="ComicId"
                             constraintName="StoriesComicFk"
                             referencedTableName="Comics"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="Tasks"
                             baseColumnNames="ComicId"
                             constraintName="TasksComicFk"
                             referencedTableName="Comics"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="TaskProperties"
                             baseColumnNames="TaskId"
                             constraintName="TaskPropertiesTaskFk"
                             referencedTableName="Tasks"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="Teams"
                             baseColumnNames="ComicId"
                             constraintName="TeamsComicFk"
                             referencedTableName="Comics"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="UsersRoles"
                             baseColumnNames="UserId"
                             constraintName="UsersRolesUserFk"
                             referencedTableName="Users"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="UsersRoles"
                             baseColumnNames="RoleId"
                             constraintName="UsersRolesRoleFk"
                             referencedTableName="Roles"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="ScrapingCacheEntries"
                             baseColumnNames="ScrapingCacheId"
                             constraintName="ScrapingCacheEntriesScrapingCacheFk"
                             referencedTableName="ScrapingCache"
                             referencedColumnNames="Id"/>
    <addForeignKeyConstraint baseTableName="UserPreferences"
                             baseColumnNames="UserId"
                             constraintName="UserPreferencesUserFk"
                             referencedTableName="Users"
                             referencedColumnNames="Id"/>

  </changeSet>
</databaseChangeLog>
